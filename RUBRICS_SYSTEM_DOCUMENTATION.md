# Rubrics System Documentation

## Overview
Sistem rubrics untuk IB MYP assessment dengan support untuk achievement levels 0-8 yang dibagi dalam bands.

## Database Structure

### Tables

#### 1. `criteria`
```sql
CREATE TABLE criteria (
    criterion_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    subject_id BIGINT NOT NULL,
    code CHAR(1) NOT NULL,  -- A, B, C, D
    name VARCHAR(255) NOT NULL,
    FOREIGN KEY (subject_id) REFERENCES subject(subject_id)
);
```

#### 2. `strands`
```sql
CREATE TABLE strands (
    strand_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    criterion_id BIGINT NOT NULL,
    year_level INT NOT NULL,  -- 1-5 for MYP
    label VARCHAR(10),  -- i, ii, iii, iv
    content TEXT NOT NULL,
    FOREIGN KEY (criterion_id) REFERENCES criteria(criterion_id)
);
```

#### 3. `rubrics`
```sql
CREATE TABLE rubrics (
    rubric_id BIGINT GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
    strand_id BIGINT NOT NULL,
    band_label VARCHAR(10) NOT NULL,  -- '0', '1-2', '3-4', '5-6', '7-8'
    description TEXT NOT NULL,
    min_score INT,  -- For sorting/calculation
    max_score INT,
    FOREIGN KEY (strand_id) REFERENCES strands(strand_id) ON DELETE CASCADE
);
```

## Business Logic for Assessment Application

### 1. Looping Through Strands
Ketika membuat aplikasi rapor, sistem akan:
- Loop terhadap semua strands untuk criterion tertentu (i, ii, iii, iv)
- Untuk setiap strand, cari rubric yang sesuai berdasarkan nilai siswa

### 2. Rubric Lookup Logic

```javascript
// Pseudocode untuk mencari rubric
function getRubricForStrand(strandId, studentScore) {
  // Query rubrics untuk strand ini
  const rubrics = getRubricsForStrand(strandId);
  
  // Cari rubric yang sesuai dengan score siswa
  const matchingRubric = rubrics.find(r => 
    studentScore >= r.min_score && 
    studentScore <= r.max_score
  );
  
  return matchingRubric;
}
```

### 3. Special Case: Strand ii dan iii

**Scenario:**
- Strand ii dan iii kadang tidak memiliki rubric untuk level 1-2
- Jika siswa mendapat nilai 1-2, maka `matchingRubric` akan **null/undefined**

**Handling:**
```javascript
function getStrandAssessment(strand, studentScore) {
  const rubric = getRubricForStrand(strand.strand_id, studentScore);
  
  if (rubric) {
    // Rubric ditemukan
    return {
      strand: strand,
      score: studentScore,
      description: rubric.description,
      assessed: true
    };
  } else {
    // Rubric tidak ditemukan (strand tidak dinilai di level ini)
    return {
      strand: strand,
      score: studentScore,
      description: "Not assessed at this level",
      assessed: false,
      isEmptyByDesign: true  // Menandakan ini sesuai kurikulum
    };
  }
}
```

### 4. Complete Assessment Flow

```javascript
function generateCriterionReport(criterionId, yearLevel, studentScore) {
  // 1. Get all strands for this criterion and year
  const strands = getStrandsForCriterion(criterionId, yearLevel);
  // Expected: [strand_i, strand_ii, strand_iii, strand_iv]
  
  // 2. Loop through each strand
  const assessments = strands.map(strand => {
    return getStrandAssessment(strand, studentScore);
  });
  
  // 3. Filter or display based on assessed status
  return {
    criterion: getCriterion(criterionId),
    finalScore: studentScore,
    strandAssessments: assessments
  };
}
```

## Example Data

### Digital Design - Criterion A - Year 1

**Strands:**
- **i**: explain and justify the need for a solution to a problem
- **ii**: state and prioritize the main points of research needed
- **iii**: describe the main features of one existing product
- **iv**: present the main findings of relevant research

**Rubrics Matrix:**

| Strand | Level 1-2 | Level 3-4 | Level 5-6 | Level 7-8 |
|--------|-----------|-----------|-----------|-----------|
| **i** | ✅ States | ✅ Outlines | ✅ Explains | ✅ Explains and justifies |
| **ii** | ❌ NULL | ✅ States some points | ✅ States and prioritizes (some guidance) | ✅ States and prioritizes (minimal guidance) |
| **iii** | ❌ NULL | ✅ States main features | ✅ Outlines main features | ✅ Describes main features |
| **iv** | ✅ States | ✅ Outlines some | ✅ Outlines main | ✅ Presents main |

### Assessment Example 1: Student Score = 6

**Loop through strands:**
1. **Strand i** (score 6): ✅ "Explains the need for a solution to a problem"
2. **Strand ii** (score 6): ✅ "States and prioritizes... with some guidance"
3. **Strand iii** (score 6): ✅ "Outlines the main features..."
4. **Strand iv** (score 6): ✅ "Outlines the main findings..."

**Result**: All strands have descriptions

### Assessment Example 2: Student Score = 2

**Loop through strands:**
1. **Strand i** (score 2): ✅ "States the need for a solution to a problem"
2. **Strand ii** (score 2): ❌ **NULL** → Display: "Not assessed at this level"
3. **Strand iii** (score 2): ❌ **NULL** → Display: "Not assessed at this level"
4. **Strand iv** (score 2): ✅ "States the findings of research"

**Result**: Strands ii and iii show "Not assessed at this level" (sesuai kurikulum)

## UI Implementation

### Current UI Features ✅

1. **Color-Coded Bands**
   - Gray: 0
   - Red: 1-2 (Limited)
   - Yellow: 3-4 (Adequate)
   - Blue: 5-6 (Substantial)
   - Green: 7-8 (Excellent)

2. **Expandable Strands**
   - Show/Hide rubrics per strand
   - Visual count of rubrics

3. **CRUD Operations**
   - Add rubric per strand
   - Edit existing rubrics
   - Delete rubrics
   - Automatic min/max score from band selection

### For Report Generation Application

**Required Query:**
```sql
-- Get all rubrics for a specific criterion and year
SELECT 
  s.strand_id,
  s.label,
  s.content,
  r.rubric_id,
  r.band_label,
  r.min_score,
  r.max_score,
  r.description
FROM strands s
LEFT JOIN rubrics r ON s.strand_id = r.strand_id
JOIN criteria c ON s.criterion_id = c.criterion_id
WHERE c.criterion_id = ? 
  AND s.year_level = ?
ORDER BY s.label, r.min_score;
```

**Display Logic:**
```jsx
function StrandAssessment({ strand, studentScore, rubrics }) {
  // Find matching rubric
  const matchingRubric = rubrics.find(r => 
    studentScore >= r.min_score && 
    studentScore <= r.max_score
  );
  
  return (
    <div className="strand-assessment">
      <div className="strand-label">{strand.label}</div>
      <div className="strand-content">{strand.content}</div>
      
      {matchingRubric ? (
        <div className="rubric-description">
          {matchingRubric.description}
        </div>
      ) : (
        <div className="not-assessed text-gray-500 italic">
          Not assessed at this level
        </div>
      )}
    </div>
  );
}
```

## Validation Rules

### When Adding Rubrics

1. **Check for Gaps**: Warn if creating gaps in score ranges
2. **Check for Overlaps**: Prevent overlapping score ranges for same strand
3. **Completeness**: Suggest creating rubrics for all common bands (0, 1-2, 3-4, 5-6, 7-8)

### Example Validation Query
```sql
-- Check if all bands are covered for a strand
SELECT 
  strand_id,
  COUNT(CASE WHEN band_label = '0' THEN 1 END) as has_0,
  COUNT(CASE WHEN band_label = '1-2' THEN 1 END) as has_1_2,
  COUNT(CASE WHEN band_label = '3-4' THEN 1 END) as has_3_4,
  COUNT(CASE WHEN band_label = '5-6' THEN 1 END) as has_5_6,
  COUNT(CASE WHEN band_label = '7-8' THEN 1 END) as has_7_8
FROM rubrics
WHERE strand_id = ?
GROUP BY strand_id;
```

## Best Practices

### 1. Data Entry
- **Start with Year 1** untuk setiap subject
- **Complete all 4 strands** (i, ii, iii, iv) sebelum pindah ke year berikutnya
- **Use consistent language** dalam descriptions
- **Mark intentionally empty** dengan komentar jika strand memang tidak dinilai di level tertentu

### 2. Curriculum Alignment
- **Strand ii dan iii** untuk Year 1 Design memang tidak punya rubric level 1-2
- Ini **bukan error**, tapi **by design** sesuai kurikulum IB MYP
- Aplikasi rapor harus handle ini dengan menampilkan "Not assessed at this level"

### 3. Report Generation
- **Always loop through strands** dalam urutan (i, ii, iii, iv)
- **Handle NULL rubrics** dengan graceful fallback
- **Show score** bahkan jika rubric tidak ada
- **Explain to users** bahwa beberapa strand tidak dinilai di level tertentu

## Future Enhancements

### 1. Bulk Import
- Template Excel untuk import rubrics
- Validation sebelum import
- Preview sebelum commit

### 2. Copy from Previous Year
- Duplicate rubrics dari Year 1 ke Year 2
- Adjust descriptions sesuai progression

### 3. Analytics
- Report completeness per subject
- Gap analysis (missing rubrics)
- Consistency check across years

### 4. Report Templates
- Pre-defined templates untuk rapor
- Customizable based on school needs
- Export to PDF/Word

## Migration Checklist

- [x] Create `criteria` table
- [x] Create `strands` table
- [x] Create `rubrics` table
- [x] Add CRUD UI for criteria
- [x] Add CRUD UI for strands
- [x] Add CRUD UI for rubrics
- [x] Color-code band levels
- [x] Implement expand/collapse rubrics
- [ ] Add validation for gaps/overlaps
- [ ] Add bulk import feature
- [ ] Create report generation page
- [ ] Implement NULL rubric handling in reports
- [ ] Add analytics dashboard

## Support

For questions about rubrics system implementation:
1. Check this documentation
2. Review sample data in database
3. Test with Digital Design Criterion A Year 1 example
4. Consult IB MYP curriculum guide for clarification on strand requirements

---

**Last Updated**: November 22, 2025  
**Version**: 1.0  
**Status**: Production Ready ✅
